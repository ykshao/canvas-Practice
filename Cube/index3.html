<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1">
        <meta name="description" content="">
        <title></title>
        <link rel="stylesheet" href="css/normalize.css">
        <style>
            body { background-color: #000; cursor: move;}
            #wrap{
                position: absolute;
                width: 100%; height: 100%;
                /*-webkit-transform-style: preserve-3d;*/
                /*-webkit-transform : translateZ(-100px);*/
            }

            #cube {
                position: absolute;
                left : 50%; top:50%;
                /*-webkit-transform-origin : 50% 50%;*/
                
            }
            
            .rolling {
                /*-webkit-animation: rolling 50s infinite;*/
            }

            #cube .plane-front  { background-color: hsla(  0, 100%, 50%, 0.7); }
            #cube .plane-back   { background-color: hsla( 60, 100%, 50%, 0.7); }
            #cube .plane-right  { background-color: hsla(120, 100%, 50%, 0.7); }
            #cube .plane-left   { background-color: hsla(180, 100%, 50%, 0.7); }
            #cube .plane-top    { background-color: hsla(240, 100%, 50%, 0.7); }
            #cube .plane-bottom { background-color: hsla(300, 100%, 50%, 0.7); }

           
            
        </style>
        <script src="js/modernizr.custom.min.js"></script>
        <script src="js/jquery-1.10.2.min.js"></script>
        <script src="js/jquery.easing.1.3.js"></script>
        <script src="js/jquery.mousewheel.js"></script>
        <script src="js/jquery.scroll.js"></script>
        <script src="js/cube.js"></script>

        <script>
            $(document).ready(function(){
                addEvent();
                setup();
            });

            var cube,cubeWrap,inner,planes  = {};
            function setup(){
                cubeWrap    = $("#cube");
                planes      = {
                     front  : $('.plane-front'),
                     back   : $('.plane-back'),
                     left   : $('.plane-left'),
                     right  : $('.plane-right'),
                     top    : $('.plane-top'),
                     bottom : $('.plane-bottom')
                };
                cube = new CUBE(cubeWrap,planes,{ width:stage.width,height:stage.height, depth:stage.width });
                // cube = new CUBE(cubeWrap,planes,{width:100,height:100});
                var scroll = new Scroll({speed:1,step:onScroll});

            }


            var stage = {},
                renderID;
            function addEvent(){
                $(window).on('resize',function(){
                    stage = windowSize();
                    stage.halfW = stage.width*0.5;
                    stage.halfH = stage.height*0.5;
                    if(typeof cube != 'undefined')cube.sizeChange({ width:stage.width,height:stage.height, depth:stage.width });
                })
                $(window).trigger('resize');
                $('body').on('mousedown',mousedown);
                $('body').on('mouseup',mouseup);
                $('body').on('mouseout',mouseup);

                renderID = requestAnimationFrame(onRender);
            };

            var downP = {x:0, y:0},disP = {x:0,y:0}, cubeRot = {rx:0,ry:0};
            function mousedown(e){
                downP.x = e.clientX;
                downP.y = e.clientY;
                disP.x = 0;
                disP.y = 0;
                $('body').bind('mousemove',mousemove);
            }
            function mousemove(e){
                var mouse = {x : e.clientX, y : e.clientY};
                disP = {x : (mouse.x-downP.x)*0.01, y: (mouse.y-downP.y)*0.01};
            }
            function mouseup(){
                $('body').unbind('mousemove',mousemove);
            }

            function onRender(){
                disP.x *= 0.9;
                disP.y *= 0.9;
                cubeRot.rx += disP.x;
                cubeRot.ry -= disP.y;

                // cube.rolling(-cubeRot.ry);
                // cube.pitching(-cubeRot.rx);
                renderID = requestAnimationFrame(onRender);
            }

            var rx = 0;
            function onScroll(offset){
                rx+=offset;
                
                if(cube.direction == 'vertical'){
                    cube.rolling(rx);
                }else if(cube.direction == 'horizon'){
                    cube.pitching(rx);
                }

                // 
                // $('#cube').css({'-webkit-transform':'rotateX('+rx+'deg)'});
            }

            function windowSize(){
                var size = { width:0,height:0};
                if (document.documentElement.clientHeight) {
                    size.width = document.documentElement.clientWidth;
                    size.height = document.documentElement.clientHeight;
                } else if (document.body.clientHeight) {
                    size.width = document.body.clientWidth;
                    size.height = document.body.clientHeight;
                } else if (window.innerHeight) {
                    size.width = window.innerWidth;
                    size.height = window.innerHeight;
                }

                return size;
            }

        </script>
    </head>
    <body>
        <div id="wrap">
            <div id="cube" class="rolling">
                <div class="plane-front">front</div>
                <div class="plane-back">back</div>
                <div class="plane-left">left</div>
                <div class="plane-right">right</div>
                <div class="plane-top">top</div>
                <div class="plane-bottom">bottom</div>
            </div>
        </div>
    </body>
</html>
