<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1">
        <meta name="description" content="">
        <title></title>
        <link rel="stylesheet" href="css/normalize.css">
        <style>
            body {
                background-color: #f00;
                width: 100%; height: 100%;
                overflow: hidden;
            }

            img { 
                position: absolute;
                left: 0;
                top: 0;
            }
            canvas {
                position: absolute;
                z-index: 1;
            }

            #wrap{
                position: absolute;
                width: 648px;
                height: 382px;
                left:50%; margin-left: -324px;
                top:50%; margin-top: -192px;
                background-color: #000;

            }

            #myCanvas {

            }   

        </style>
        <script src="js/jquery-1.10.2.min.js"></script>
        <script src="js/jquery.easing.1.3.js"></script>
        <script src="js/canvas-0.02.js"></script>
        <script src="js/firefly.js"></script>

        <script>
            $(document).ready(function(){
                var img = new Image();
                img.src = 'img/photo1.jpg';
                img.onload = function(){
                    var canvas = new Canvas('#canvasWrap',0,img.width,img.height);
                    $(canvas).bind(canvas.EVENT_CHANGE,function(e,data){
                        if(data.type == 'ready'){
                            var colorData;
                            canvas.drawImage(img,0,0);
                            canvas.getImageData({},function(imgData){
                                colorData = imgData;
                                var fd = new FigureDraw(colorData);
                                canvas.addDrawList('figureDraw',fd)
                                canvas.start();

                                $(canvas.getCanvas()).on('mousemove',function(e){
                                    // fd.globalAlpha = e.clientX/img.width;
                                    // $(canvas.getCanvas()).css({opacity:fd.globalAlpha});
                                });

                                
                            });
                            canvas.draw = function(){
                                // canvas.drawImage(img,0,0);
                            }
                        }
                    })
                }
            });


            var FigureDraw = function(imgData){
                var lists       = [],
                    max         = 5000;

                this.globalAlpha = .1;

                this.draw = function(ctx){
                    for(var o in lists){
                        var data = lists[o];
                        data.a += (1-data.a)*data.sp;

                        if(data.a > .999){
                            data.a = 1;
                        }

                        ctx.save();
                        ctx.fillStyle = 'rgba('+data.r+','+data.g+','+data.b+','+data.a*this.globalAlpha+')';
                        ctx.fillRect(data.x+data.w*(1-data.a)*0.5,data.y+data.h*(1-data.a)*0.5,data.w*data.a,data.h*data.a);
                        ctx.restore();

                        if(data.a >= 1){
                            lists[o] = this.makeFigure();
                        }
                    }
                    
                    
                    
                    
                }

                this.init = function(ctx){
                    for(var i=0; i<max; i++){
                        lists.push(this.makeFigure());
                    }
                }

                this.makeFigure = function(){
                    var w = 15*Math.random(),
                        h = 15*Math.random(),
                        x = Math.floor(Math.random()*(imgData.width-w)),
                        y = Math.floor(Math.random()*(imgData.height-h)),
                        a = .5,
                        data = imgData.data[x][y];
                        
                    return {
                        x : x,
                        y : y,
                        w : w,
                        h : h,
                        a : a,
                        r : data.r,
                        g : data.g,
                        b : data.b,
                        sp : Math.random()
                    }
                }


                this.init();
            }



            FigureDraw.prototype.constructor  = FigureDraw;
             
        </script>
    </head>
    <body> 
        </div>
        <!-- <img class="photo" src="img/photo2.jpg"> -->
        <div id="canvasWrap"></div>
    </body>
</html>



<!--  
 HTMLCanvasElement

    toDataURL()
    getContext()

 メソッド
    addColorStop()
    arc()
    arcTo()
    beginPath()
    bezierCurveTo()
    clearRect()
    clip()
    closePath()
    createImageData()
    createLinearGradient()
    createPattern()
    createRadialGradient()
    drawFocusRing()
    drawImage()
    fill()
    fillRect()
    fillText()
    getImageData()
    isPointInPath()
    lineTo()
    measureText()
    moveTo()
    putImageData()
    quadraticCurveTo()
    rect()
    restore()
    rotate()
    save()
    scale()
    setTransform()
    stroke()
    strokeRect()
    strokeText()
    translate()
    transform()

プロパティ
    fillStyle
    font
    globalAlpha
    globalCompositeOperation
    lineCap
    lineJoin
    lineWidth
    miterLimit
    shadowBlur
    shadowColor
    shadowOffsetX
    shadowOffsetY
    strokeStyle
    textAlign
    textBaseline
 */

 -->