<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1">
        <meta name="description" content="">
        <title></title>
        <link rel="stylesheet" href="css/normalize.css">
        <style>

            body {
                background-color: #000;
                width: 100%; height: 100%;
                padding: 0; margin : 0;
                overflow: hidden;
            }

            #img-color {
                position: absolute;
                /*left:300px;*/
                /*top:200px;*/
            }   

            div {
                position: absolute;
                width: 100%;
                height: 100%;
                background: #c00;
            }

            canvas {
                position: absolute;
                width: auto;
                width:100%; height: auto;
            }

            .img {
                position: absolute;
                opacity: 0.5;
                display: none;
            }

        </style>
        <script src="js/jquery-1.10.2.min.js"></script>
        <script src="js/jquery.easing.1.3.js"></script>
        <script src="js/jquery.imgfit.js"></script>
        <script src="js/dat.gui.min.js"></script>
    </head>


    <body>
        <img id="img1" class="img" src="img/1.jpg">
        <img id="img2" class="img" src="img/2.jpg">
        <img id="img3" class="img" src="img/3.jpg">
        <img id="img4" class="img" src="img/4.jpg">
        <!-- <img id="img5" class="img" src="img/4.jpg"> -->
        <!-- <img id="img6" class="img" src="img/4.jpg"> -->
        <canvas width="1024" height="600" id="cvs"></canvas>
        <script>

            $(document).ready(function(){

                var $cvs = $('#cvs'),
                    ctx = $cvs[0].getContext('2d');

                var imgs = $('.img');
                var initRot = 0;
                var rectPos = [
                        {width:300,height:300,vertexts:[],center:{x:200,y:150},speed:Math.random()*2-1,rotation:initRot,type:'composite'},
                        {width:300,height:300,vertexts:[],center:{x:500,y:150},speed:Math.random()*2-1,rotation:initRot,type:'composite'},
                        {width:200,height:200,vertexts:[],center:{x:800,y:150},speed:Math.random()*2-1,rotation:initRot,type:'clip'},
                        {width:200,height:200,vertexts:[],center:{x:200,y:400},speed:Math.random()*2-1,rotation:initRot,type:'clip'}
                        // {width:200,height:200,vertexts:[],center:{x:500,y:400},speed:Math.random2(10.5,rotation:initRot,type:'composite'},
                        // {width:200,height:200,vertexts:[],center:{x:800,y:400},speed:Math.random()*-0.5,rotation:initRot,type:'composite'}
                    ];

                for(var o in rectPos){
                    var info = rectPos[o];
                    info.rotationOrigin = Math.random()*360;
                    info.vertexts = makeSquareVertex(info.center,info.width,info.height);
                }

                setTimeout(function(){
                    // draw(0);
                    requestAnimationFrame(render);
                },100);

                function draw(t){
                    // draw_type1();   
                    draw_type2();                 
                }   

                function draw_type1(){
                    for(var o in rectPos){
                        var info = rectPos[o];
                        info.rotation = info.rotationOrigin+t*info.speed;
                        ctx.globalCompositeOperation = 'source-over';

                        // ctx.save();
                        for(var i=0,n=info.vertexts.length; i<n; i++){
                            var vts = info.vertexts[i];
                            vts     = two_dimensional_rotate(info.center,vts,info.rotation*Math.PI/180);
                            vts.x   = vts.x;
                            vts.y   = vts.y;
                            if(i==0){
                                ctx.beginPath();
                                ctx.moveTo(vts.x,vts.y);
                            }else{
                                ctx.lineTo(vts.x,vts.y);
                            }
                            if(i==n-1){
                                // ctx.closePath();
                            }
                        }
                        // ctx.restore();

                        if(info.type == 'clip'){
                            ctx.save();
                            ctx.clip();
                            ctx.drawImage(imgs[o],0,0);
                            ctx.restore();
                        }else{
                            ctx.closePath();
                            // ctx.save();
                            ctx.fill();
                            ctx.globalCompositeOperation = 'source-in';
                            ctx.drawImage(imgs[o],0,0);
                            // ctx.restore();
                            // ctx.globalCompositeOperation = 'source-over';
                        }
                    }
                }

                function draw_type2(){
                    // ctx.fillStyle = 'rgba(255,0,0,1)';
                    // ctx.save();

                    // ctx.fillStyle = 'rgba(0,255,0,1)';
                    // ctx.save();

                    // ctx.fillStyle = 'rgba(0,0,255,1)';
                    // ctx.save();

                    // ctx.fillStyle = 'rgba(255,255,255,1)';
                    // ctx.save();
                    var w = 200, h = 200;

                    ctx.save();
                    // ctx.beginPath();
                    ctx.rotate(10*Math.PI/180);
                    ctx.fillRect(700,100,w,h);
                    ctx.globalCompositeOperation = 'source-in';
                    ctx.drawImage(imgs[2],0,0);
                    ctx.restore();
                    ctx.globalCompositeOperation = 'source-over';

                    ctx.save();
                    ctx.beginPath();
                    ctx.rotate(10*Math.PI/180);
                    ctx.fillRect(100,350,w,h);
                    ctx.globalCompositeOperation = 'source-in';
                    ctx.drawImage(imgs[3],0,0);
                    ctx.restore();
                    ctx.globalCompositeOperation = 'source-over';

                    ctx.save();
                    ctx.beginPath();
                    ctx.rotate(10*Math.PI/180);
                    ctx.rect(100,100,w,h);
                    ctx.clip();
                    ctx.drawImage(imgs[0],0,0);
                    ctx.restore();

                    ctx.save();
                    ctx.rotate(10*Math.PI/180);
                    ctx.beginPath();
                    ctx.rect(400,100,w,h);
                    ctx.clip();
                    ctx.drawImage(imgs[1],0,0);
                    ctx.restore();



                    // ctx.restore();

                    // ctx.restore();
                    // ctx.fillRect(300,100,100,100);

                    // ctx.restore();
                    // ctx.fillRect(500,100,100,100);

                    // ctx.restore();
                    // ctx.fillRect(700,100,100,100);
                }

                var t = 0, t2 = 0;
                function render(){
                    requestAnimationFrame(render);
                    ctx.clearRect(0,0,1024,600);

                    t += 1;
                    t2 += (t-t2)*0.01;
                    draw(t2)

                };

                function makeSquareVertex(center,width,height){
                    return [
                        {x:info.center.x-width*0.5,y:info.center.y-height*0.5},
                        {x:info.center.x+width*0.5,y:info.center.y-height*0.5},
                        {x:info.center.x+width*0.5,y:info.center.y+height*0.5},
                        {x:info.center.x-width*0.5,y:info.center.y+height*0.5}
                    ];

                }
                function two_dimensional_rotate(center,position,rad){
                    return { 
                        x: ((position.x-center.x)*Math.cos(rad) - (position.y-center.y)*Math.sin(rad))+center.x, 
                        y: ((position.x-center.x)*Math.sin(rad) + (position.y-center.y)*Math.cos(rad))+center.y
                    }
                }

            });
        </script>
    </body>
</html>



<!--  
 HTMLCanvasElement

    toDataURL()
    getContext()

 メソッド
    addColorStop()
    arc()
    arcTo()
    beginPath()
    bezierCurveTo()
    clearRect()
    clip()
    closePath()
    createImageData()
    createLinearGradient()
    createPattern()
    createRadialGradient()
    drawFocusRing()
    drawImage()
    fill()
    fillRect()
    fillText()
    getImageData()
    isPointInPath()
    lineTo()
    measureText()
    moveTo()
    putImageData()
    quadraticCurveTo()
    rect()
    restore()
    rotate()
    save()
    scale()
    setTransform()
    stroke()
    strokeRect()
    strokeText()
    translate()
    transform()

プロパティ
    fillStyle
    font
    globalAlpha
    globalCompositeOperation
    lineCap
    lineJoin
    lineWidth
    miterLimit
    shadowBlur
    shadowColor
    shadowOffsetX
    shadowOffsetY
    strokeStyle
    textAlign
    textBaseline
 */

 -->